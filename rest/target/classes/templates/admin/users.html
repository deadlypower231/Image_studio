<html xmlns:th="http://thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <link href="../styles/styles.css" rel="stylesheet"/>
    <link href="../styles/bootstrap.min.css" rel="stylesheet"/>
    <script type="text/javascript" src="../js/jquery-3.6.0.min.js"></script>
    <script type="text/javascript" src="../js/bootstrap.min.js"></script>
</head>

<body class="bg-dark">
<div class="d-flex justify-content-end p-sm-3 bg-dark" style="height : 4.5rem;">
    <div class="dropdown show" sec:authorize="hasAnyRole('USER', 'ADMIN', 'MASTER')">
        <a class="btn btn-secondary dropdown-toggle" role="button" id="dropdownMenuLink" data-toggle="dropdown"
           aria-haspopup="true" aria-expanded="false"
           th:text="${currentUser.firstName} + ' ' + ${currentUser.lastName}">
        </a>
        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuLink">
            <a class="dropdown-item" href="/">Страница пользователя</a>
            <a class="dropdown-item" href="/settings">Настройки</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item " href="/logout">Выйти</a>
        </div>
    </div>
</div>
<ul class="nav nav-tabs bg-dark">
    <li class="nav-item">
        <a class="nav-link active bg-info" href="/admin/users">Пользователи</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="/admin/tournaments">Турниры</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="/admin/masters">Мастера</a>
    </li>
</ul>
<div>
    <table class="table table-dark table-striped">
        <thead>
        <th scope="col">
            #
        </th>
        <th scope="col">
            Имя пользователя
        </th>
        <th scope="col">
            Имя
        </th>
        <th scope="col">
            Фамилия
        </th>
        <th scope="col">
            Роли
        </th>
        <th scope="col">
            Изменить роли
        </th>
        <th scope="col">
            Удалить пользователя
        </th>
        </thead>
        <tbody>
        <tr th:each="entity,iterator : ${users}">
            <td th:text="${iterator.index+1}"></td>
            <td th:text="${entity.username}"></td>
            <td th:text="${entity.firstName}"></td>
            <td th:text="${entity.lastName}"></td>
            <td th:text="${entity.roles}"></td>
            <td>
                <button type="button" class="btn btn-info btn-sm"
                        data-bs-toggle="modal" th:attr="data-bs-target='#activeModal' + ${entity.id}" >Изменить роли
                </button>
                <div th:id="'activeModal' + ${entity.id}" class="modal fade" role="dialog">
                    <div class="modal-dialog modal-sm">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h6 class="modal-title" th:text="'Выберите роли для ' + ${entity.username}" style="color:black;"></h6>
                            </div>
                            <div class="modal-body">
                                <form action="#" th:action="'/admin/users/roles/' + @{${entity.id}}" th:object="${user}" th:method="post">
                                    <input type="hidden" th:field="*{idUser}" th:value="${entity.id}">
                                    <div th:each="role: ${roles}">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" th:value="${role.roleName}" th:field="*{roles}" id="ROLE_USER">
                                            <label class="form-check-label" for="ROLE_USER" th:text="${role.roleName}" style="color:red;"/>
                                        </div>
                                    </div>
                                    <input type="submit" value="Применить" class="btn btn-success btn-sm double-button ">
                                </form>
                                <button type="button" class="btn btn-danger btn-sm double-button" data-bs-dismiss="modal">Отмена</button>
                            </div>
                        </div>
                    </div>
                </div>
            </td>
            <td>
                <button type="button" class="btn btn-danger btn-sm"
                        data-bs-toggle="modal" th:attr="data-bs-target='#activeModal' + ${entity.id}" >Удалить
                </button>
                <div th:id="'activeModal' + ${entity.id}" class="modal fade" role="dialog">
                    <div class="modal-dialog modal-sm">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h6 class="modal-title" th:text="'Удалить ' + ${entity.username} + '?'" style="color:black;"></h6>
                            </div>
                            <div class="modal-body">
                                    <p style="color:red;">Вы уверены что хотите удалить?</p>
                                <form action="#" th:action="'/admin/users/delete/' + @{${entity.id}}" th:method="post">
                                    <input type="submit" value="Удалить" class="btn btn-danger ">
                                </form>
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
                            </div>
                        </div>
                    </div>
                </div>
            </td>
        </tr>
        </tbody>
    </table>
</div>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
</body>
</html>